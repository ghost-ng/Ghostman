================================================================================
MIGRATION 004 - FILE COLLECTIONS FEATURE
================================================================================

FILE LOCATION:
  ghostman/src/infrastructure/conversation_management/migrations/versions/
  004_add_collections_tables.py

REVISION INFO:
  Revision ID:      004
  Down Revision:    003
  Status:           Ready to apply

TABLES CREATED (4):
  1. collections           - Main collection metadata
  2. collection_files      - Files in each collection
  3. collection_tags       - Collection organization tags
  4. conversation_collections - Many-to-many link table

INDEXES CREATED (8):
  Collections:
    - idx_collections_name
    - idx_collections_created_at
    - idx_collections_is_template

  Collection Files:
    - idx_collection_files_collection_id
    - idx_collection_files_checksum

  Collection Tags:
    - idx_collection_tags_collection_id

  Conversation Collections:
    - idx_conversation_collections_conversation
    - idx_conversation_collections_collection

FOREIGN KEYS:
  collection_files.collection_id → collections.id (CASCADE)
  collection_tags.collection_id → collections.id (CASCADE)
  conversation_collections.conversation_id → conversations.id (CASCADE)
  conversation_collections.collection_id → collections.id (CASCADE)

APPLY MIGRATION:
  cd ghostman/src/infrastructure/conversation_management
  alembic upgrade head

ROLLBACK MIGRATION:
  cd ghostman/src/infrastructure/conversation_management
  alembic downgrade 003

CHECK STATUS:
  alembic current    # Show current version
  alembic history    # Show all migrations
  alembic heads      # Show latest revision

DATABASE PATH:
  %APPDATA%\Ghostman\db\conversations.db
  (Typically: C:\Users\<username>\AppData\Roaming\Ghostman\db\conversations.db)

SCHEMA VERSION:
  Before: 3
  After:  4

VALIDATION:
  python test_migration_004.py

FEATURES ENABLED:
  ✓ Create reusable file collections
  ✓ Attach collections to multiple conversations
  ✓ Track file checksums (SHA256)
  ✓ Tag collections for organization
  ✓ Template collections for quick setup
  ✓ Configure RAG chunking per collection
  ✓ Enforce collection size limits

NEXT STEPS:
  1. Create SQLAlchemy ORM models
  2. Implement repository classes
  3. Build collection management UI
  4. Integrate with RAG pipeline
  5. Add import/export functionality

================================================================================
